package NSM;
import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.security.NoSuchAlgorithmException;
import java.util.*;

public class Main
{ 
  public static void main(String args[]) throws IOException, NoSuchAlgorithmException, InterruptedException
  {
    String YN;
    String md5Sum = null;
    //Reads the database from db.txt for BoyerMoore,
    //And proves it isn't looping infinitely  
    BufferedReader in = new BufferedReader(new FileReader("db.txt"));
		StringBuilder db = new StringBuilder();
    /*StringBuilder needs to be used...
    String chonky on resources, StringBuilder not */
    String line = in.readLine();
    while(line != null)
    { 
      db.append(line);
      line = in.readLine();
    }
        in.close(); //Free resources
    do{
      YN = "Z";
      //establish md5 and input classes
      MD5 encryption1 = new MD5();
      @SuppressWarnings("resource")
	Scanner input = new Scanner(System.in);
  
        //check file input
      String file = null;
      System.out.println("Please enter the directory of the file you would like to scan(ex: TestFiles/ShoppingList.txt): ");
      do{
            file = input.nextLine();
          //enter input into md5sum calc 
        try{
          md5Sum = encryption1.fEncrypt(file);
        } catch (Exception e) {
          System.out.println ("Error: Please enter a valid file in an existing working directory.");
          file = null;
          }
        }while(file == null);
      
        // System.out.print("\033[H\033[2J"); 
        // System.out.flush();
      BoyerMoore alg = new BoyerMoore(md5Sum);

      if(alg.search(db.toString()) == true)
      {
        System.out.println("File is malicious, deleting...");
        File delFile = new File(file); //incase file is evil, need filetype to be a File, not a string
        delFile.delete();
        System.out.println("WATCH WHAT YOU DOWNLOAD!!! \nWould you like to scan another? (Y/N)");
      } 
      else
      {
        System.out.println("Your file is safe!\nNothing in the directory will be changed. Would you like to scan another? (Y/N) \n");      
      }
      while(!YN.equals("Y") && !YN.equals("N"))
      YN = input.nextLine().toUpperCase(); 
  }while(!YN.equals("N"));
    System.out.println("Goodbye!");
    System.exit(0);
}
}